<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Perfil</title>
    <link rel="stylesheet" href="styles/styles.css">
</head>
<body>

<header>
    <div class="logo-spotifiuba" onclick="window.location.href='index.html'">
        <span class="negro">Spoti</span><span class="blanco">FIUBA</span>
    </div>

    <div class="botones-header">
        <button id="logout" onclick="logout()" class = "boton-header">Cerrar sesión</button>
    </div>
</header>

<div class="input-login">
    <h1 id="nombre-perfil">Editar perfil</h1>

    <div class="barra-input">
        <label>Nombre de usuario</label>
        <input id="input-nombre">
    </div>
    <div class="barra-input">
                    <label for="carrera">Carrera:</label>
                    <select class="select-pagina" name="carreras" id="carrera">
                        <option value="Ingeniería Civil">Ingeniería Civil</option>
                        <option value="Ingeniería en Alimentos">Ingeniería en Alimentos</option>
                        <option value="Ingeniería en Energía Eléctrica">Ingeniería en Energía Eléctrica</option>
                        <option value="Ingeniería Electrónica">Ingeniería Electrónica</option>
                        <option value="Ingeniería en Agrimensura">Ingeniería en Agrimensura</option>
                        <option value="Ingeniería en Informática">Ingeniería en Informática</option>
                        <option value="Ingeniería en Petróleo">Ingeniería en Petróleo</option>
                        <option value="Ingeniería Industrial">Ingeniería Industrial</option>
                        <option value="Ingeniería Mecánica">Ingeniería Mecánica</option>
                        <option value="Ingeniería Naval">Ingeniería Naval</option>
                        <option value="Ingeniería Química">Ingeniería Química</option>
                        <option value="Lic. en Análisis de Sistemas">Lic. en Análisis de Sistemas</option>
                        <option value="Bioingeniería">Bioingeniería</option>
                    </select>
                </div>

   

    <div class="barra-input">
        <label>Nueva contraseña</label>
        <input id="input-contrasenia" type="password">
    </div>

    <div class="boton-wrapper">
        <button class="boton-subir" onclick="guardarCambios()">Guardar cambios</button>
    </div>
</div>

<script>
const usuario = JSON.parse(localStorage.getItem("usuario"));

if (!usuario) {
    window.location.href = "iniciar-sesion.html";
}

document.getElementById("input-nombre").value = usuario.nombre;
const selectCarrera = document.getElementById("carrera");
selectCarrera.value = usuario.carrera;


async function guardarCambios() {
    const nombreInput = document.getElementById("input-nombre");
    const carreraSelect = document.getElementById("carrera");
    const passInput = document.getElementById("input-contrasenia");

    if (!nombreInput || !carreraSelect) {
        alert("Error interno: campos no encontrados");
        return;
    }

    const body = {
        nombre_usuario: nombreInput.value,
        carrera: carreraSelect.value
    };

    if (passInput.value !== "") {
        body.contrasenia = passInput.value;
    }

    const res = await fetch(`http://localhost:3000/usuarios/${usuario.id}`, {
        method: "PATCH",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(body)
    });

    if (!res.ok) {
        alert("error al actualizar perfil");
        return;
    }

    localStorage.removeItem("usuario");
    alert("Perfil actualizado. Inicia sesión nuevamente.");
    window.location.href = "iniciar-sesion.html";
}


function logout() {
    localStorage.removeItem("usuario");
    window.location.href = "iniciar-sesion.html";
}
</script>

</body>
</html>
