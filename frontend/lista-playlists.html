<!DOCTYPE html>
<html lang="es">
    <head>
        <meta charset="UTF-8">
        <title>SpotiFIUBA</title>
        <link rel="stylesheet" href="styles/styles.css">
    </head>
    <body>
        <header>
            <div class="logo-spotifiuba" onclick="window.location.href='index.html'">
                <span class="negro">Spoti</span><span class="blanco">FIUBA</span><span class="tooltip">Ir a la Página Principal</span>
            </div>
        </header>
        <div class="saludo">
            <p id="titulo-playlists"></p>
            <hr class="separador">
        </div>
        <div class="contenedor-canciones" id="contenedor-playlists">
            <div class="cancion-elemento">
                <img src="PORTADA" class="cancion-portada">
                <div class="detalles-cancion">
                    <h3 class="cancion-titulo">Nombre de Playlist</h3>
                </div>
            </div>
        </div>
        <div id="boton-musica">
            <button id="subir-musica"><h2>+</h2><span class="tooltip">Ir a Subir Música</span></button>
        </div>
        <script>
            const URLParametros = new URLSearchParams(window.location.search);
            const usuario_id = URLParametros.get("id_usuario");
            async function cargarPlaylists() {
                const contenedorPlaylists = document.getElementById("contenedor-playlists");
                try {
                    
                    const res = await fetch(`http://localhost:3000/usuarios/${usuario_id}/playlists`);

                    if(!res.ok) {
                        alert("Hubo un problema cargando las playlists.");
                        return;
                    }

                    const playlists = await res.json();
                    contenedorPlaylists.innerHTML = "";
                    document.getElementById("titulo-playlists").textContent = "Playlists de: " + playlists[0].nombre_usuario;


                    playlists.forEach(playlist => {
                        const elemento = document.createElement("div");
                        elemento.classList.add("cancion-elemento");
                        
                        elemento.innerHTML = `
                            <img src="${playlist.link_portada || 'https://i.pinimg.com/736x/b1/56/d8/b156d88727d0be3f16e79af15f66a122.jpg'}" class="cancion-portada">
                            <div class="detalles-cancion">
                                <h3 class="cancion-titulo">${playlist.nombre}</h3>
                                </div>
                            </div>
                        `;
                        elemento.addEventListener("click", () =>
                            window.location.href = `playlist.html?id=${playlist.id}&nombrePlaylist=${playlist.nombre}`
                        )
                        contenedorPlaylists.appendChild(elemento);
                    });
                } 
                catch {
                    alert("No se pudo conectar con el servidor.");
                    window.location.href = "index.html";
                }
            }

            cargarPlaylists();
            const botonSubirMusica = document.getElementById("subir-musica");
            botonSubirMusica.addEventListener("click", () => {
                window.location.href = "new-playlist.html";
            })
        </script>
    </body>
</html>