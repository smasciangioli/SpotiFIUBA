<!DOCTYPE html>
<html lang="es">
    <head>
        <meta charset="UTF-8">
        <title>SpotiFIUBA</title>
        <link rel="stylesheet" href="styles/styles.css">
    </head>
    <body>
        <header>
        <div class="logo-spotifiuba" onclick="window.location.href='index.html'">
            <span class="negro">Spoti</span><span class="blanco">FIUBA</span><span class="tooltip">Ir a la Página Principal</span>
        </div>
        </header>
        <div class="input-login">
            <form id ="form-registro">
                <div class="barra-input">
                    <label for="nombre_usuario">Nombre de Usuario:</label>
                    <input type="text" id="nombre_usuario" name="nombre_usuario">
                </div>
                <div class="barra-input">
                    <label for="email">Correo Electrónico (email, gmail, etc):</label>
                    <input type="email" id="email" name="email">
                </div>
                <div class="barra-input">
                    <label for="contrasenia">contraseña:</label>
                    <input type="password" id="contrasenia" name="contrasenia">
                </div>
                <div class="barra-input">
                    <label for="carrera">Carrera:</label>
                    <select class="select-pagina" name="carreras" id="carrera">
                        <option value="Ingeniería Civil">Ingeniería Civil</option>
                        <option value="Ingeniería en Alimentos">Ingeniería en Alimentos</option>
                        <option value="Ingeniería en Energía Eléctrica">Ingeniería en Energía Eléctrica</option>
                        <option value="Ingeniería Electrónica">Ingeniería Electrónica</option>
                        <option value="Ingeniería en Agrimensura">Ingeniería en Agrimensura</option>
                        <option value="Ingeniería en Informática">Ingeniería en Informática</option>
                        <option value="Ingeniería en Petróleo">Ingeniería en Petróleo</option>
                        <option value="Ingeniería Industrial">Ingeniería Industrial</option>
                        <option value="Ingeniería Mecánica">Ingeniería Mecánica</option>
                        <option value="Ingeniería Naval">Ingeniería Naval</option>
                        <option value="Ingeniería Química">Ingeniería Química</option>
                        <option value="Lic. en Análisis de Sistemas">Lic. en Análisis de Sistemas</option>
                        <option value="Bioingeniería">Bioingeniería</option>
                    </select>
                </div>
                <div class="boton-wrapper">
                    <button class="boton-subir" type="submit">Continuar</button>
                </div>
            </form>
            <div class="link-registro" onclick="window.location.href='iniciar-sesion.html'">
                    <p>¿Ya tenés una cuenta? Hacé click para ir a iniciar tu sesión.</p>
            </div>
                
            <script>
                const form = document.getElementById("form-registro");
                
                
                form.addEventListener("submit", async function(e) {
                    e.preventDefault();
                
                    const nombre_usuario = document.getElementById("nombre_usuario").value.trim();
                    const email = document.getElementById("email").value.trim();
                    const carrera = document.getElementById("carrera").value;
                    const contrasenia = document.getElementById("contrasenia").value;
                    if (!nombre_usuario || !email || !contrasenia) {
                        alert("Completa todos los campos obligatorios");
                        
                        return;
                    }
                    
                
                    try {
                        const respuesta = await fetch("http://localhost:3000/usuarios", {
                            method: "POST",
                            headers: { "Content-Type": "application/json" },
                            body: JSON.stringify({ nombre_usuario, email, carrera, contrasenia })
                        });
                
                        console.log("Respuesta POST /usuarios:", respuesta.status);
                        if (!respuesta.ok) {
                            const error = await respuesta.text().catch(()=>"");
                            throw new Error(error || `status ${respuesta.status}`);
                        }
                
                        window.location.href = "iniciar-sesion.html";
                    } catch (fallo) {
                        console.error(fallo);
                        alert(fallo.message || "Error en la petición");
                    } 
                    
                });
            </script>
        
    </body>
</html>
