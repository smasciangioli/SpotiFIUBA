<!DOCTYPE html>
<html lang="es">
    <head>
        <meta charset="UTF-8">
        <title>SpotiFIUBA</title>
        <link rel="stylesheet" href="styles/styles.css">
    </head>
    <body>
        <header>
            <div class="logo-spotifiuba" onclick="window.location.href='index.html'">
                <span class="negro">Spoti</span><span class="blanco">FIUBA</span><span class="tooltip">Ir a la Página Principal</span>
            </div>
        </header>
        <div class="input-login">
            <form id="form-playlist">
                <div class="barra-input">
                    <label for="nombre">Nombre de la Playlist:</label>
                    <input type="text" id="nombre" name="nombre">
                </div>
                <div class="barra-input">
                    <label for="link_portada">Link a Imagen de Portada de la Playlist: - Opcional</label>
                    <input type="text" id="link_portada" name="link_portada">
                </div>
                <div class = "boton-wrapper">
                    <button class= "boton-subir" type="submit">Crear Playlist</button>
                </div>
            </form>
            <script>
                const usuario = JSON.parse(localStorage.getItem("usuario"));
                const form = document.getElementById("form-playlist");

                form.addEventListener("submit", async (e) => {
                e.preventDefault();

                const nombre = document.getElementById("nombre").value.trim();
                let link_portada = document.getElementById("link_portada").value.trim();
                if(link_portada === "") {
                    link_portada = null;
                }
                const creador_id = usuario.id;

                if (!nombre) {
                    alert("Completa todos los campos obligatorios");
                    return;
                }

                try {
                    const respuesta = await fetch("http://localhost:3000/playlists", {
                        method: "POST",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify({ nombre, creador_id, link_portada})
                    });

                    if(!respuesta.ok) {
                        alert("Error al crear la playlist.");
                        return;
                    }
                    window.location.href = `lista-playlists.html?id_usuario=${usuario.id}`

                } catch {
                    alert("Error en la petición.")
                }
            })
            </script>
    </body>
</html>