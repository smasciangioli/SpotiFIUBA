<!DOCTYPE html>
<html lang="es">
    <head>
        <meta charset="UTF-8">
        <title>SpotiFIUBA</title>
        <link rel="stylesheet" href="styles/styles.css">
    </head>
    <body>
        <header>
            <div class="logo-spotifiuba" onclick="window.location.href='index.html'">
                <span class="negro">Spoti</span><span class="blanco">FIUBA</span><span class="tooltip">Ir a la Página Principal</span>
            </div>
        </header>
        <div class="perfil-main">
            <h1 id = "nombre-perfil">
                Hola (nombre)
            </h1>
            <hr class = "separador"> 
            <p class="perfil-email">
                Email: <span id="email-perfil"></span>
                
                </p>
                <p class="perfil-email">
                Carrera: <span id = "carrera-perfil"></span>
                </p>

            <div class = "botones-acciones">
                <a href = "new-music.html" class = "boton-subir"> Subir Cancion </a>
                 <a href = "playlist.html" class="boton-subir"> Nueva Playlist</a>
                 <a href = "editar.html" class ="boton-subir">Editar perfil</a>
                 <button id="boton-canciones-usuario" class = "boton-subir">Tus Canciones</button>

            </div>
        <div class = "cuadro-playlists">
            <h2> Tus playlists</h2>
            <ul>
                <li>Playlist 1</li>
                <li>Playlist 2</li>
                <li>Playlist 3</li>
            </ul>
            
       </div>     
        
        <div>
        
            <p id="logout">Cerrar Sesion</p>
        </div>
    </div>
          

        <script>
            async function validarLogin() {
                const usuario = JSON.parse(localStorage.getItem("usuario"));

                if (!usuario) {
                    window.location.href = "index.html";
                    return;
                }

                try {
                    const res = await fetch(`http://localhost:3000/usuarios/${usuario.id}`)

                    if(!res.ok){
                        localStorage.clear();
                        window.location.href = "index.html";
                        return;
                    }

                    cargarPerfil(usuario)

                } catch (fallo){
                    console.error(fallo);
                    localStorage.clear();
                    window.location.href = "index.html";
                }
            }

            function cargarPerfil(usuario) {
                document.getElementById("nombre-perfil").textContent =
                `Hola ${usuario.nombre}`;

                document.getElementById("email-perfil").textContent =
                usuario.email;
                document.getElementById("carrera-perfil").textContent = usuario.carrera;
                document.getElementById("boton-canciones-usuario").addEventListener("click", () => {
                    window.location.href = `lista-canciones.html?id=${usuario.id}`;
                })
                const botonLogout = document.getElementById("logout")
                botonLogout.addEventListener("click", () =>{
                if(confirm("¿Estás seguro que querés cerrar sesion?")) {
                    localStorage.removeItem("usuario");
                    window.location.href = "index.html";
                } 
                });
            }

            validarLogin();
            </script>
    </body>
</html>
    
        
    
